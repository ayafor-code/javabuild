  node {
  def mavenHome = tool name: 'maven3.9.11'
  def imageName = "zenithafrica/mlink"
  def imageTag = "v1.0.0"
  def dockerImage = "${imageName}:v1.0.0"
  
  stage('1. Clone Code'){
      git branch: 'main', credentialsId: 'github-cred', url: 'https://github.com/ayafor-code/javabuild.git'
  }
  stage('2. Maven Build'){
      sh "${mavenHome}/bin/mvn package"
  }
  stage('3. Build Docker Image'){
      sh "docker build -t ${imageName}:v1.0.0 ." 
  }
  stage('4. Docker Login'){
      withCredentials([usernamePassword(credentialsId: 'docker-cred', passwordVariable: 'DOCKER_PASS', usernameVariable: 'DOCKER_USER')]) {
        sh "echo ${DOCKER_PASS} | docker login -u ${DOCKER_USER} --password-stdin"
      }
}
 stage('5. Docker Push'){
     sh "docker push ${dockerImage}"
 }
 stage('6. Docker logout'){
     sh 'docker logout'
    }
      
  }
 
